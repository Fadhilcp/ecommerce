
<style>
    * {
        margin: 0;
        padding: 0;
    }

    body {
        background-color: #f5f5f5;
    }

    .header {
        background: white;
        padding: 1rem 2rem;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .logo {
        font-size: 2rem;
        color: #333;
        font-weight: bold;
        text-decoration: none;
    }

    .nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-top: 1rem;
    }

    .nav-links {
        display: flex;
        gap: 2rem;
    }

    .nav-links a {
        text-decoration: none;
        color: #333;
        font-weight: 500;
    }

    .search-cart {
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .search-box {
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .search-button {
        background: #ff6b00;
        color: white;
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
    }

    .cart {
        text-decoration: none;
        color: #333;
    }

    .main-content {
        display: flex;
    }

    .sidebar {
        width: 250px;
        background: white;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .sidebar-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 1rem;
        color: #333;
        text-decoration: none;
        border-bottom: 1px solid #eee;
    }

    .sidebar-item.active {
        background: #ef7c00;
        color: white;
    }

    .profile-content {
        flex: 1;
        place-items: center;
        background: white;
        padding: 2rem;
        border-radius: 4px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .profile-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
    }

    .profile-image {
        width: 100px;
        height: 100px;
        background: #ddd;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .profile-info h2 {
        margin-bottom: 0.5rem;
    }

    .profile-details {
        margin-top: 2rem;
    }

    .profile-details p {
        margin-bottom: 1rem;
        color: #333;
    }

    .profile-details strong {
        display: inline-block;
        width: 100px;
    }


    /* Form css */
            

    
            .forms input {
                font-family: "Rokkitt", Georgia, serif;
                width: 100%;
                padding: 10px;
                margin: 5px 0;
                outline: none;
                border: none;
                background-color: #d9d9d9;
            }
    
            .confirm-button {
                margin: 5px 0;
                text-align: center;
            }
  
    
            .confirm-button {
                font-family: "Rokkitt", Georgia, serif;
                font-size: x-large;
                width: 100%;
                background-color: #ef7c00;
                color: rgb(0, 0, 0);
                outline: none;
                border: none;
                cursor: pointer;
            }
    
            .confirm-button:hover {
                background-color: #884600;
            }
    
            @media (min-width: 768px) {
                .main-content {
                    flex-direction: row;
                    justify-content: center;
                }
            }

            .msg{
                text-align: center;
                margin: 20px;
            }
</style>




<!-- setting header -->
<%- include("../../views/partials/user/header") %>


<div class="main-content">
    <aside class="sidebar">
        <a href="/account" class="sidebar-item">Profile</a>
        <a href="/orders" class="sidebar-item">Orders</a>
        <a href="/wallet" class="sidebar-item">Wallet</a>
        <a href="/address" class="sidebar-item">My Address</a>
        <a href="/updateProfile" class="sidebar-item">Update Profile</a>
        <a href="/changePassword" class="sidebar-item active">Change Password</a>
        <a href="/logout" class="sidebar-item">Logout</a>
    </aside>

    <main class="profile-content">

        <form action="/login" method="post" class="forms" id="loginForm">


            <input id="currentPassword" name="currentPassword" type="password" placeholder="CURRENT PASSWORD">
            <input id="newPassword" name="newPassword" type="password" placeholder="NEW PASSWORD">
            <input id="confirmPassword" name="confirmPassword" type="password" placeholder="CONFIRM PASSWORD">


                <div class="alert text-danger text-center">
                </div>
            <p class="text-danger text-center" id="err-message" style="font-family: sans-serif;"></p>


            <button type="submit" id="submit-btn" class="confirm-button">CONFIRM</button>
        </form>

    </main>
</div>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>

    document.addEventListener('DOMContentLoaded',function(){
                    document.getElementById('submit-btn').addEventListener('click',formValidate)
                })


            async function formValidate(event){
                    event.preventDefault()

                    var currentPassword = document.getElementById('currentPassword').value.trim()
                    var newPassword = document.getElementById('newPassword').value.trim()
                    var confirmPassword = document.getElementById('confirmPassword').value.trim()
                    var msg = document.getElementById('err-message')
                    let isValid = true

                    msg.innerHTML = ''


                    var passwordPattern1 = /^(?=.*[a-zA-Z])/
                    var passwordPattern2 = /^(?=.*[0-9])/

                    if (currentPassword == '') {
                    msg.innerHTML = 'Current Password is required'
                    isValid = false
                   }else if (newPassword == '') {
                    msg.innerHTML = 'New Password is required'
                    isValid = false
                   }else if(confirmPassword == ''){
                    msg.innerHTML = 'Confirm Password is Required'
                    isValid = false
                   }else if (newPassword.length < 8) {
                    msg.innerHTML = 'Password must be at least 8 characters long'
                    isValid = false
                   }else if (newPassword && !passwordPattern1.test(newPassword)) {
                    msg.innerHTML = 'Password must contain at least one letter'
                    isValid = false
                   }else if (newPassword && !passwordPattern2.test(newPassword)) {
                    msg.innerHTML = 'Password must contain at least one number'
                    isValid = false
                   }

                   if (isValid) {
                       try {
                        
                        const response = await fetch('/changePassword',{
                            method:'POST',
                            headers:{
                                'content-type':'application/json'
                            },
                            body:JSON.stringify({currentPassword,newPassword,confirmPassword})
                        })

                        const data = await response.json()

                        if(response.ok && data.status){
                           await Swal.fire({
                                 icon: 'success',
                                 title: 'Success!',
                                 text: 'Password changed successfully.',
                                 showConfirmButton: false,
                                 timer: 2000
                              })
                            window.location.reload()
                        }else{
                            msg.innerHTML = data.message
                        }
                       } catch (error) {
                        msg.innerHTML = 'Failed to connect to the server'
                        console.error('Fetch error',error)
                       }
                   }
                }
</script>


<!-- jQuery -->
<script src="js/jquery.min.js"></script>
<!-- popper -->
<script src="js/popper.min.js"></script>
<!-- bootstrap 4.1 -->
<script src="js/bootstrap.min.js"></script>
<!-- jQuery easing -->
<script src="js/jquery.easing.1.3.js"></script>
 <!-- Waypoints -->
 <script src="js/jquery.waypoints.min.js"></script>
 <!-- Flexslider -->
 <script src="js/jquery.flexslider-min.js"></script>
 <!-- Owl carousel -->
 <script src="js/owl.carousel.min.js"></script>
 <!-- Magnific Popup -->
 <script src="js/jquery.magnific-popup.min.js"></script>
 <script src="js/magnific-popup-options.js"></script>
 <!-- Date Picker -->
 <script src="js/bootstrap-datepicker.js"></script>
 <!-- Stellar Parallax -->
 <script src="js/jquery.stellar.min.js"></script>
 <!-- Main -->
 <script src="js/main.js"></script>
</body>
</html>